<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Upload to GitHub</title>
</head>
<body>
    <h1>Upload Image to GitHub</h1>
    <input type="file" id="fileInput" accept="image/*">
    <button id="uploadButton">Upload</button>
    <p id="result"></p>

    <script>
        document.getElementById('uploadButton').addEventListener('click', async () => {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            const githubToken = "Z2hwXjlBQ3Z6U3dNRGxqU3JYRFd0Tk1hYldSRG5IM3Z3eUpXcHdkbGx2ZzN2c29yZW1nbGV1bVh3PQ=="; // Base64 encoded token
            const username = "chirpimageupload"; // Ensure this is correct
            const repo = "chirp-post-images"; // Ensure this is correct
            const targetFileName = `image-${Date.now()}.jpg`; // Use a unique filename

            if (file) {
                const reader = new FileReader();
                reader.onloadend = async () => {
                    const base64Content = reader.result.split(',')[1]; // Get Base64 content
                    const url = `https://api.github.com/repos/${username}/${repo}/contents/${targetFileName}`;
                    const headers = {
                        "Authorization": "Basic " + githubToken,
                        "Accept": "application/vnd.github.v3+json"
                    };
                    const body = JSON.stringify({
                        message: `Upload ${targetFileName}`,
                        content: base64Content
                    });

                    try {
                        const response = await fetch(url, {
                            method: 'PUT',
                            headers: headers,
                            body: body
                        });

                        const json = await response.json();
                        if (response.ok) {
                            document.getElementById('result').textContent = `Uploaded URL: ${json.content.download_url}`;
                        } else {
                            throw new Error(json.message || "Error uploading file");
                        }
                    } catch (error) {
                        console.error("Error:", error);
                        document.getElementById('result').textContent = `Error: ${error.message}`;
                    }
                };
                reader.readAsDataURL(file);
            } else {
                alert('Please select a file to upload.');
            }
        });
    </script>
</body>
</html>
